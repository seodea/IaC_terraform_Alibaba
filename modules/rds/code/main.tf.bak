
#data "alicloud_db_instance_classes" "default" {
#  engine         = var.engine
#  engine_version = var.engine_version
#  category       = "HighAvailability"
#  storage_type   = var.instance_storage_type
#}

module "mysql" {
  source = "./module"
  region = "cn-shanghai"
  
  #################
  # Rds Instance
  #################
  engine               = "MySQL"
  engine_version       = "8.0"
  instance_type        = "rds.mysql.s2.large"
  instance_storage     = 20
  instance_charge_type = "Postpaid"
  instance_name        = "dev-rds"
  security_group_ids   = [] # 필수인지?
  vswitch_id           = "vsw-uf664nwetcqg8idogp9tu"
  security_ips         = ["1.1.1.0/24","2.2.2.0/24"]
  #tags                 = { created = "Terraform"}
 
  #################
  # Rds Backup policy
  #################
  preferred_backup_period     = ["Monday", "Wednesday"]
  preferred_backup_time       = "00:00Z-01:00Z"
  backup_retention_period     = 7
  log_backup_retention_period = 7
  #enable_backup_log           = ture
  
  #################
  # Rds Connection
  #################
  #port                       = var.port
  #connection_prefix          = var.connection_prefix
  #allocate_public_connection = var.allocate_public_connection
  
  #################
  # Rds Database account
  #################
  type           = "Normal"
  privilege      = "ReadWrite" #default ReadOnly
  account_name   = "megazone"
  password       = "test123!@#"
  
  #################
  # Rds Database
  #################
  databases       = [
    {
      name = "dbuserv1"
      character_set = "utf8"
      description   = "db1"
    },
    {
      name = "dbuserv2"
      character_set = "utf8"
      description   = "db2"
    }
  ]
}

module "databases" {
  source                  = "./module/database/"
  region                  = "cn-shanghai"
  #create_database         = var.create_database # variables에 등록
  #create_account          = var.create_account # variables에 등록
  db_instance_id          = module.mysql.sql_id
  
  #################
  # Rds Database account
  #################
  type           = "Normal"
  privilege      = "ReadWrite" #default ReadOnly
  account_name   = "megazone"
  password       = "test123!@#"

  #################
  # Rds Database
  #################
  databases       = [
    {
      name = "dbuserv1"
      character_set = "utf8"
      description   = "db1"
    },
    {
      name = "dbuserv2"
      character_set = "utf8"
      description   = "db2"
    }
  ]  

}
